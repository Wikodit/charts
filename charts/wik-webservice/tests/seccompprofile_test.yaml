suite: seccomp profile tests
templates:
  - deployment.yaml
tests:
  - it: should add seccompProfile with RuntimeDefault by default
    set:
      webservice:
        image: nginx:latest
    asserts:
      - equal:
          path: spec.template.spec.containers[0].securityContext.seccompProfile.type
          value: "RuntimeDefault"
  - it: should allow custom seccompProfile when containerSecurityContext is provided
    set:
      webservice:
        image: nginx:latest
        containerSecurityContext:
          seccompProfile:
            type: Localhost
            localhostProfile: "profiles/custom.json"
    asserts:
      - equal:
          path: spec.template.spec.containers[0].securityContext.seccompProfile.type
          value: "Localhost"
      - equal:
          path: spec.template.spec.containers[0].securityContext.seccompProfile.localhostProfile
          value: "profiles/custom.json"
  - it: should allow disabling seccompProfile
    set:
      webservice:
        image: nginx:latest
        containerSecurityContext:
          seccompProfile:
            type: Unconfined
    asserts:
      - equal:
          path: spec.template.spec.containers[0].securityContext.seccompProfile.type
          value: "Unconfined"
  - it: should preserve other security context settings when customizing seccompProfile
    set:
      webservice:
        image: nginx:latest
        containerSecurityContext:
          seccompProfile:
            type: RuntimeDefault
          runAsUser: 2000
    asserts:
      - equal:
          path: spec.template.spec.containers[0].securityContext.seccompProfile.type
          value: "RuntimeDefault"
      - equal:
          path: spec.template.spec.containers[0].securityContext.runAsUser
          value: 2000
