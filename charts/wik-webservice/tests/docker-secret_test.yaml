suite: docker secret tests
templates:
  - docker-secret.yaml
tests:
  - it: should create a docker registry secret when imagePullAuth is provided
    set:
      webservice:
        image: nginx:latest
        imagePullAuth:
          registry: registry.example.com
          username: myuser
          password: mypass
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: type
          value: kubernetes.io/dockerconfigjson
      - equal:
          path: metadata.name
          value: release-name-wik-webservice-registry
      - exists:
          path: data.".dockerconfigjson"

  - it: should not create docker secret when imagePullAuth is not provided
    set:
      webservice:
        image: nginx:latest
        imagePullAuth: {}
    asserts:
      - hasDocuments:
          count: 0

  - it: should include encrypted value when sealedSecrets is enabled
    set:
      general:
        sealedSecrets: true
      webservice:
        image: nginx:latest
        imagePullAuth:
          registry: registry.example.com
          username: myuser
          password: mypass
          encrypted: AgBy3i4OJSWK+PiTySYZZA9rO43cGDEQAx...
    asserts:
      - hasDocuments:
          count: 0  # Should be rendered in sealed-secret.yaml instead
