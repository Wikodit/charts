suite: sealed-secret tests
templates:
  - sealed-secret.yaml
tests:
  - it: should create a sealed-secret when sealedSecrets is enabled
    set:
      general:
        sealedSecrets: true
      webservice:
        image: nginx:latest
        env:
          secret:
            SECRET_KEY: secret-value
    asserts:
      - isKind:
          of: SealedSecret
      - equal:
          path: metadata.name
          value: release-name-wik-webservice
      - equal:
          path: metadata.labels.app.kubernetes.io/name
          value: wik-webservice

  - it: should not create sealed-secret when sealedSecrets is disabled
    set:
      general:
        sealedSecrets: false
      webservice:
        image: nginx:latest
        env:
          secret:
            SECRET_KEY: secret-value
    asserts:
      - hasDocuments:
          count: 0
